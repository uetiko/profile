<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta property="og:title" content="Angel Profile">
  <meta property="og:description" content="CV interactivo de Angel Barrientos en formato de escritorio retro (Win95/GNOME 1).">
  <meta property="og:type" content="profile">
  <meta property="og:site_name" content="Angel Barrientos">
  <meta property="og:locale" content="es_MX">
  <meta property="profile:first_name" content="Angel">
  <meta property="profile:last_name" content="Barrientos">
  <meta property="profile:username" content="uetiko">
  <meta property="profile:gender" content="male">
  <meta property="og:image" content="https://d3vyx978zojruw.cloudfront.net/img/profile/angel_war.png">
  <meta property="og:url" content="https://www.uetiko.com/">
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:site" content="@OldSilents">
  <meta name="twitter:creator" content="@OldSilents">
  <meta name="twitter:title" content="Angel Profile">
  <meta name="twitter:description" content="CV interactivo de Angel Barrientos en formato de escritorio retro (Win95/GNOME 1).">
  <meta name="twitter:image" content="https://d3vyx978zojruw.cloudfront.net/img/profile/angel_war.png">
  <meta name="theme-color" content="#0a0c10">
  <title>Angel Barrientos â€” Retro Desktop</title>
  <meta name="description" content="CV interactivo de Angel Barrientos en formato de escritorio retro (Win95/GNOME 1)." />
  <link rel="icon" href="https://d3vyx978zojruw.cloudfront.net/icon.svg" type="image/svg+xml" />
  <link rel="stylesheet" href="./css/style.css">

  <!-- GA4: sustituye G-XXXXXX por tu Measurement ID -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-6CR8Q1NYHV"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-6CR8Q1NYHV', { transport_type: 'beacon', send_page_view: false });
  </script>
</head>
<body>
<main id="app" class="desktop" @contextmenu.prevent>
  <!-- Desktop icons -->
  <nav class="desktop-grid">
    <div class="icon" tabindex="0" @dblclick="openApp('about')" @click="telemetry.click('icon', {element:'about'})">
      <img alt="About" src="https://api.iconify.design/mdi:account-badge.svg" />
      <span>{{ t('icons.about') }}</span>
    </div>
    <div class="icon" tabindex="0" @dblclick="openApp('experience')" @click="telemetry.click('icon', {element:'experience'})">
      <img alt="Experience" src="https://api.iconify.design/mdi:briefcase.svg" />
      <span>{{ t('icons.experience') }}</span>
    </div>
    <div class="icon" tabindex="0" @dblclick="openApp('skills')" @click="telemetry.click('icon', {element:'skills'})">
      <img alt="Skills" src="https://api.iconify.design/mdi:code-tags.svg" />
      <span>{{ t('icons.skills') }}</span>
    </div>
    <div class="icon" tabindex="0" @dblclick="openApp('education')" @click="telemetry.click('icon', {element:'education'})">
      <img alt="Education" src="https://api.iconify.design/mdi:school.svg" />
      <span>{{ t('icons.education') }}</span>
    </div>
    <div class="icon" tabindex="0" @dblclick="openApp('download')" @click="telemetry.click('icon', {element:'download'})">
      <img alt="Download CV" src="https://api.iconify.design/mdi:file-download.svg" />
      <span>{{ t('icons.cv') }}</span>
    </div>
    <div class="icon" tabindex="0" @dblclick="openApp('contact')" @click="telemetry.click('icon', {element:'contact'})">
      <img alt="Contact" src="https://api.iconify.design/mdi:email.svg" />
      <span>{{ t('icons.contact') }}</span>
    </div>
  </nav>

  <!-- Windows -->
  <template v-for="win in windows">
    <article class="window" :class="{solid: !compositor.glass}" :style="win.style" :key="win.id" :data-win-id="win.id" @mousedown="focus(win.id)">
      <header class="titlebar" @dblclick="toggleMaximize(win.id)" @mousedown="startDrag($event, win.id)">
        <div class="title">
          <span class="pill">{{ win.icon }}</span>
          <span>{{ win.title }}</span>
        </div>
        <nav class="controls">
          <button class="btn" title="Minimize" @click.stop="minimize(win.id); telemetry.cta('window_minimize',{
          name:win.id,
          element:'minimize_button',
          variant:win.minimized ? 'minimize' : 'restore'
          })">â€“</button>
          <button class="btn" title="Maximize" @click.stop="toggleMaximize(win.id); telemetry.cta('window_maximize',{
          name:win.id,
          element:'maximize_button',
          variant:win.maximized ? 'maximize' : 'restore'
          })">â–¢</button>
          <button class="btn" title="Close" @click.stop="closeWindow(win.id); telemetry.cta('window_close',{
          name:win.id,
          element:'close_button'
          })">Ã—</button>
        </nav>
      </header>
      <section class="content">
        <component
          :is="win.component"
          :t="t"
          :lang="lang"
          v-bind="win.props"
          @open-viewer="openViewer"
          @download="telemetry.download({name: win.id, element:'link'})"
          @submit="telemetry.formSubmit($event)"
        />
      </section>
      <div class="resizer" @mousedown="startResize($event, win.id)"></div>
    </article>
  </template>
  <div v-if="drag.ghost" class="ghost" :style="drag.ghostStyle"></div>

  <!-- Panel / Taskbar -->
  <footer class="panel">
    <button class="start" @click="ui.menu = !ui.menu; telemetry.click('start_button',{element:'start'})">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M4 4h7v7H4V4m9 0h7v7h-7V4M4 13h7v7H4v-7m9 0h7v7h-7v-7Z"/></svg>
      <strong>Start</strong>
    </button>
    <nav class="taskbar">
      <button v-for="task in tasks" :key="task.id" :data-id="task.id" class="task" :class="{active: task.active}" @click="restore(task.id); focus(task.id)">{{ task.title }}</button>
    </nav>
    <aside class="status">
      <span class="badge">{{ clock }}</span>
      <span class="badge" title="Language">
          <span class="link" @click="setLang(lang === 'es' ? 'en' : 'es')">{{ lang.toUpperCase() }}</span>
        </span>
      <span class="muted">{{ env }} Â· {{ appName }}</span>
    </aside>
  </footer>
  <!-- Start Menu -->
  <nav v-if="ui.menu" class="menu" @click.outside>
    <div class="item" @click="openApp('about'); ui.menu=false">
      <span>ðŸ›ˆ</span><div>{{ t('menu.about') }}<div class="hint">{{ t('menu.about_hint') }}</div></div><span class="kbd">Enter</span>
    </div>
    <div class="item" @click="openApp('experience'); ui.menu=false"><span>ðŸ’¼</span><div>{{ t('menu.experience') }}</div><span></span></div>
    <div class="item" @click="openApp('skills'); ui.menu=false"><span>ðŸ§°</span><div>{{ t('menu.skills') }}</div><span></span></div>
    <div class="item" @click="openApp('education'); ui.menu=false"><span>ðŸŽ“</span><div>{{ t('menu.education') }}</div><span></span></div>
    <div class="item" @click="openApp('download'); ui.menu=false"><span>â¬‡</span><div>{{ t('menu.download') }}</div><span></span></div>
    <div class="item" @click="openApp('contact'); ui.menu=false"><span>âœ‰</span><div>{{ t('menu.contact') }}</div><span></span></div>
    <div class="item" @click="openApp('badges'); ui.menu=false"><span></span><div>{{ t('menu.badges')}}</div><span></span></div>
    <div class="hr"></div>
    <div class="item" @click="compositor.toggleGlass(); telemetry.cta('toggle_compositor',{variant: compositor.glass ? 'glass' : 'solid'})"><span>ðŸªŸ</span><div>{{ t('menu.compositor') }}</div><span></span></div>
  </nav>
</main>

<!-- Vue 3 (CDN) -->
<script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
<script type="module">
  /* ============================
     Utilities & Kernel Services
     ============================ */
  /**
   * Generates a random UUID (Universally Unique Identifier) following the RFC4122 version 4 standard.
   * This implementation does not use cryptographic functionality, ensuring maximum compatibility across environments.
   *
   * The generated UUID has the format `xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx` where:
   * - `x` is replaced with a random hexadecimal digit (0-9, a-f).
   * - The `y` position is replaced with a random hexadecimal digit in the range 8-11.
   *
   * @returns {string} A randomly generated RFC4122 v4 UUID.
   */
  const uuidv4 = () => {
    // RFC4122 v4, no crypto for max compatibility
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, c => {
      const r = Math.random() * 16 | 0, v = c === 'x' ? r : (r & 0x3 | 0x8); return v.toString(16);
    });
  };

  const nowISO = () => new Date().toISOString();

  /* i18n minimal */
  /**
   * Multilingual content and labels for the UI.
   *
   * This object contains structured translations for different segments of the application in Spanish (es) and English (en).
   */
  const messages = {
    es: {
      icons: { about: 'Acerca de mÃ­', experience: 'Experiencia', skills: 'Skills', education: 'EducaciÃ³n', cv: 'Descargar CV', contact: 'Contacto' },
      menu: { about: 'Acerca de Angel', about_hint: 'Perfil y resumen ejecutivo', experience: 'Experiencia', skills: 'Competencias tÃ©cnicas', education: 'FormaciÃ³n', download: 'Descargar CV (PDF)', contact: 'Contacto', compositor: 'Alternar compositor (vidrio/sÃ³lido)' },

      about: {
        title: 'Angel Barrientos â€” Technical Lead & Software Architect',
        summary: 'Ingeniero en sistemas con 16 aÃ±os de experiencia. Especializado en backend, con criterio de arquitectura y operaciÃ³n.',
        profile: 'Me formÃ© en backend con orientaciÃ³n a objetos â€”mucho PHP desde hace ~13 aÃ±osâ€” y paso profesional por Java (1.6), Perl, Python, C#/.NET Core y JavaScript. TambiÃ©n administro infraestructura: primero on-premise; hoy AWS.',
        location: 'UbicaciÃ³n: CDMX Â· modalidad actual: remoto',
        languages: 'Idiomas: EspaÃ±ol nativo Â· InglÃ©s B1',
        value: 'Valor: Orden en entornos caÃ³ticos, decisiones tÃ©cnicas sostenibles, documentaciÃ³n que explica el porquÃ© y no sÃ³lo el quÃ©.',
        role_now: 'LÃ­der tÃ©cnico: estÃ¡ndares, revisiones, soporte a equipos, coordinaciÃ³n con negocio y clientes. Mantengo AWS y cierro brechas de cÃ³digo legado.',
        softskills: 'Soft Skills: NegociaciÃ³n, comunicaciÃ³n asertiva, escucha activa, manejo de sesgos, delegaciÃ³n y selecciÃ³n. Sirven para que la parte tÃ©cnica llegue entera al usuario.',
      },

      experience: {
        title: 'Experiencia profesional destacada',
        items: [
          { role: 'Technical Lead', company: 'Nyx', period: '2023â€“Presente', details: 'Arquitectura AWS, automatizaciÃ³n, observabilidad y estÃ¡ndares de entrega.' },
          { role: 'Senior Software Engineer', company: 'VASS Latam / TelefÃ³nica Chile', period: '2021â€“2023', details: 'Magento 2.4; refactor de pagos; reducciÃ³n de errores crÃ­ticos; checkout mÃ¡s rÃ¡pido.' },
          { role: 'Senior Backend', company: 'PagoFÃ¡cil.net', period: '2018â€“2021', details: 'Gateway CNP para Magento; facturaciÃ³n electrÃ³nica; antifraude.' },
          { role: 'Developer / Jr PM', company: 'Enova', period: '2014â€“2018', details: 'Scrum + XP, documentaciÃ³n tÃ©cnica, despliegues en proyectos educativos.' },
          { role: 'Freelance / Consultor', company: 'Varios', period: '2008â€“2014', details: 'PHP full-stack, Linux admin, soporte Java para e-commerce e institucional.' }
        ]
      },

      skills: {
        title: 'Competencias tÃ©cnicas',
        paragraphs: [
          'Backend como especialidad. PHP es mi lenguaje principal; el resto lo uso con respeto: Python, C#/.NET, JavaScript; antes Java y Perl.',
          'Bases de datos: SQL estÃ¡ndar (MySQL/MariaDB, PostgreSQL, Oracle) a nivel consulta y operaciÃ³n; admin mÃ¡s frecuente: MySQL/MariaDB, PostgreSQL y SQL Server on-premise.',
          'NoSQL: Amazon DocumentDB (compatibilidad MongoDB 3.6/4.0/5.0). No es un fork; es un motor propio compatible con la API.',
          'Infraestructura: AWS (Lambda, S3, CloudFront, IAM, DocumentDB, CloudWatch). Contenedores y orquestaciÃ³n: Docker â†’ Kubernetes â†’ OpenShift.',
          'Arquitectura: Clean Architecture, DDD, SOLID, CQRS, CI/CD. Linux y Git en casa.'
        ]
      },

      download: { title: 'Descarga de CV', hint: 'VersiÃ³n ejecutiva en PDF para reclutadores.' },
      education: { title: 'FormaciÃ³n y aprendizaje continuo' },
      contact: { title: 'Contacto directo' }
    },

    en: {
      icons: { about: 'About me', experience: 'Experience', skills: 'Skills', education: 'Education', cv: 'Download CV', contact: 'Contact' },
      menu: {
        about: 'About Angel', about_hint: 'Profile & executive summary', experience: 'Experience',
        skills: 'Technical skills', education: 'Education', download: 'Download CV (PDF)', contact: 'Contact',
        compositor: 'Toggle compositor (glass/solid)', badges: 'Badges'
      },

      about: {
        title: 'Angel Barrientos â€” Technical Lead & Software Architect',
        summary: 'Software engineer with 16 years of experience. Backend-first, with architectural and operational criteria.',
        profile: 'OO-oriented backend â€”~13 years of PHPâ€” with professional stints in Java (1.6), Perl, Python, C#/.NET Core and JavaScript. Infra admin on-prem first; today AWS.',
        location: 'Mexico City Â· current mode: remote',
        languages: 'Native Spanish Â· English B1',
        value: 'Order under pressure, sustainable technical decisions, documentation that explains the why â€”not only the what.',
        role_now: 'Technical lead: standards, reviews, team support, business/client coordination. I keep AWS healthy and close gaps in legacy code.',
        softskills: 'Negotiation, assertive communication, active listening, bias handling, delegation and hiring. They make the technical part land intact.'
      },

      experience: {
        title: 'Highlighted professional experience',
        items: [
          { role: 'Technical Lead', company: 'Nyx', period: '2023â€“Present', details: 'AWS architecture, automation, observability and delivery standards.' },
          { role: 'Senior Software Engineer', company: 'VASS Latam / TelefÃ³nica Chile', period: '2021â€“2023', details: 'Magento 2.4; payments refactor; fewer critical errors; faster checkout.' },
          { role: 'Senior Backend', company: 'PagoFÃ¡cil.net', period: '2018â€“2021', details: 'CNP gateway for Magento; e-invoicing; antifraud.' },
          { role: 'Developer / Jr PM', company: 'Enova', period: '2014â€“2018', details: 'Scrum + XP, technical docs, deployments in education projects.' },
          { role: 'Freelance / Consultant', company: 'Various', period: '2008â€“2014', details: 'PHP full-stack, Linux admin, Java support for e-commerce and institutional.' }
        ]
      },

      skills: {
        title: 'Technical competencies',
        paragraphs: [
          'Backend as a specialty. PHP is my main language; I use the rest with respect: Python, C#/.NET, JavaScript; earlier Java and Perl.',
          'Databases: standard SQL (MySQL/MariaDB, PostgreSQL, Oracle) for querying and ops; more admin experience with MySQL/MariaDB, PostgreSQL and on-prem SQL Server.',
          'NoSQL: Amazon DocumentDB (MongoDB API compatibility 3.6/4.0/5.0). Not a fork; its own engine with API compatibility.',
          'Infrastructure: AWS (Lambda, S3, CloudFront, IAM, DocumentDB, CloudWatch). Containers & orchestration: Docker â†’ Kubernetes â†’ OpenShift.',
          'Architecture: Clean Architecture, DDD, SOLID, CQRS, CI/CD. Linux and Git at home.'
        ]
      },

      download: { title: 'CV download', hint: 'Executive PDF version for recruiters.' },
      education: { title: 'Education & continuous learning' },
      contact: { title: 'Direct contact' }
    }
  };


  const i18n = (lang) => (key) => key.split('.').reduce((o,k)=> (o||{})[k], messages[lang]) || key;

  /**
   * A class for managing client-side telemetry, allowing for the tracking and sending of user interaction events
   * such as page views, clicks, and custom event types. This class utilizes the `gtag` library if available,
   * falling back to debug logs when the library is not present.
   */
  class Telemetry {
    constructor({ env = 'dev', app = 'desktop' } = {}) {
      this.env = env; this.app = app;
      this.session_id = sessionStorage.getItem('session_id') || uuidv4();
      sessionStorage.setItem('session_id', this.session_id);
      this.client_id = undefined; // optional â€” try GA4 fetch
      try {
        if (window.gtag) {
          // Attempt to get GA4 client_id (best-effort; async via callback signature)
          // Replace 'G-XXXXXX' below if you want this to work in production
          window.gtag('get', 'G-6CR8Q1NYHV', 'client_id', (cid) => { this.client_id = cid; });
        }
      } catch {}
    }
    /**
     * Constructs a base event object with various default properties.
     *
     * @return {Object} An object containing the following properties:
     * - event_id: A unique identifier for the event.
     * - ts: The current timestamp in ISO format.
     * - page_path: The path of the current page.
     * - page_location: The full URL of the current page.
     * - page_title: The title of the current page.
     * - env: The environment from which the event is being sent.
     * - app: The application identifier related to the event.
     * - session_id: The current session's unique identifier.
     * - client_id: The unique identifier for the client.
     * - transport_type: The transport method used for sending this event (default is 'beacon').
     */
    base() {
      return {
        event_id: uuidv4(),
        ts: nowISO(),
        page_path: location.pathname,
        page_location: location.href,
        page_title: document.title,
        env: this.env,
        app: this.app,
        session_id: this.session_id,
        client_id: this.client_id,
        transport_type: 'beacon'
      };
    }
    /**
     * Sends an event with the specified name and additional data.
     *
     * @param {string} name - The name of the event to be sent.
     * @param {Object} [extra={}] - Optional additional data to include with the event.
     * @return {void}
     */
    send(name, extra = {}) {
      const payload = { ...this.base(), ...extra };
      if (window.gtag) {
        window.gtag('event', name, payload);
      } else {
        console.debug('[telemetry:fallback]', name, payload);
      }
    }
    pageView(extra={}){ this.send('page_view', extra); }
    click(scope, extra={}){ this.send('click', { scope, ...extra }); }
    cta(name, extra={}){ this.send('cta', { name, ...extra }); }
    openWindow(name, extra={}){ this.send('open_window', { name, ...extra }); }
    closeWindow(name, extra={}){this.send('close_window', { name, ...extra }); }
    formSubmit(extra){ this.send('form_submit', {...extra}); }
    download(extra){ this.send('download', {...extra}); }
    videoPlay(extra){ this.send('video_play', {...extra}); }
    error(scope, extra){ this.send('error', { scope, ...extra }); }
  }

  /**
   * Manages a stack of window instances with functionality to create, focus, minimize,
   * maximize, restore, close, and style windows.
   */
  class WindowManager {
    constructor() { this.stack = []; this.z = 2000; }
    create({ id, title, icon, component, x=120, y=120, w=720, h=460 }) {
      const win = { id, title, icon, component, x, y, w, h, minimized: false, maximized: false, z: ++this.z };
      this.stack.push(win); return win;
    }
    /**
     * Adjusts the z-index of the specified window and updates the window stack order.
     *
     * @param {string} id - The unique identifier of the window to focus.
     * @return {void} - Does not return a value.
     */
    focus(id){ const w = this.find(id); if (!w) return; w.z = ++this.z; this.stack = this.stack.sort((a,b)=>a.z-b.z); }
    /**
     * Searches for an item in the stack by its unique identifier and returns it if found.
     *
     * @param {number|string} id - The unique identifier of the item to be searched.
     * @return {Object|undefined} The item matching the given id, or undefined if not found.
     */
    find(id){ return this.stack.find(w=>w.id===id); }
    /**
     * Closes and removes an item from the stack based on the provided identifier.
     *
     * @param {string|number} id - The unique identifier of the item to close and remove.
     * @return {void} Does not return any value.
     */
    close(id){ this.stack = this.stack.filter(w=>w.id!==id); }
    /**
     * Minimizes the object identified by the given ID.
     *
     * @param {string|number} id - The unique identifier of the object to minimize.
     * @return {void} Does not return a value.
     */
    minimize(id){ const w=this.find(id); if(w){ w.minimized=true; } }
    /**
     * Restores a specific window by its identifier, setting its minimized state to false
     * and bringing it into focus.
     *
     * @param {string|number} id The identifier of the window to be restored.
     * @return {void}
     */
    restore(id){ const w=this.find(id); if(w){ w.minimized=false; this.focus(id);} }
    /**
     * Toggles the maximized state of a specific window identified by its ID.
     * If the window is maximized, it restores the previous dimensions and position.
     * If the window is not maximized, it adjusts its size and position to fit the screen.
     *
     * @param {string} id - The unique identifier of the window to be toggled.
     * @return {void} This method does not return a value.
     */
    toggleMax(id){ const w=this.find(id); if(!w) return; w.maximized=!w.maximized; if(w.maximized){ w.prev={x:w.x,y:w.y,w:w.w,h:w.h}; w.x=12; w.y=12; w.w=innerWidth-24; w.h=innerHeight-54; } else if(w.prev){ Object.assign(w, w.prev); w.prev=undefined; }
    }
    /**
     * Generates a style string for a given window object based on its properties.
     *
     * @param {Object} win - The window object containing style attributes.
     * @param {number} win.z - The z-index of the window.
     * @param {boolean} win.minimized - Indicates whether the window is minimized.
     * @param {number} win.x - The x-coordinate (left position) of the window.
     * @param {number} win.y - The y-coordinate (top position) of the window.
     * @param {number} win.w - The width of the window.
     * @param {number} win.h - The height of the window.
     * @return {string} A string representing the CSS style for the window.
     */
    style(win){
      const base = `z-index:${win.z};` + (win.minimized? 'display:none;' : '');
      return base + `left:${win.x}px;top:${win.y}px;width:${win.w}px;height:${win.h}px;`;
    }
    /**
     * Synchronizes the current state of a specific window to its corresponding DOM element.
     *
     * @param {string} id - The identifier of the window to synchronize.
     * @return {void} Does not return any value.
     */
    syncToDOM(id) {
      const w = this.find(id);
      if (!w) return;
      const el = document.querySelector(`.window[data-win-id="${id}"]`);
      if (!el) return;
      el.style.cssText = this.style(w);
    }
  }

  /* ============================
     EventBus, State & Effect Managers
     ============================ */
  /**
   * EventBus is a simple implementation of the observer pattern that facilitates event subscription, unsubscription, and event emission.
   */
  class EventBus {
    constructor(){ this.map = new Map(); }
    on(evt, handler){ if(!this.map.has(evt)) this.map.set(evt, new Set()); this.map.get(evt).add(handler); return ()=>this.off(evt, handler); }
    off(evt, handler){ const s=this.map.get(evt); if(s){ s.delete(handler); if(!s.size) this.map.delete(evt); } }
    emit(evt, payload){ const s=this.map.get(evt); if(s){ for(const h of [...s]){ try{ h(payload); }catch(e){ console.debug('[bus:error]', evt, e); } } } }
  }

  /**
   * Manages application state through a centralized object with helper methods.
   * Provides functionality to get, set, toggle, and retrieve a snapshot of the current state.
   */
  class StateManager {
    /**
     * Creates an instance of the class with configurable initialization.
     *
     * @param {Object} [init={}] An object that specifies initial states for the instance.
     * @param {boolean} [init.glass=true] Whether the glass effect is enabled.
     * @param {string} [init.wallpaper='https://fedoraproject.org/w/uploads/f/f9/F42-01-night.jpg'] The URL of the wallpaper image.
     * @param {string} [init.fit='cover'] Determines how the wallpaper image is resized to fit its container.
     * @param {boolean} [init.effectsEnabled=true] Indicates whether visual effects are enabled.
     * @param {boolean} [init.reducedMotion=false] Indicates whether motion should be reduced for accessibility purposes.
     * @param {number} [init.animationSpeed=1.0] Multiplier factor for animation speed where 1.0 is normal speed.
     *
     * @return {void}
     */
    constructor(init = {}){
      this.state = Object.assign({
        glass: true,
        wallpaper: 'https://fedoraproject.org/w/uploads/f/f9/F42-01-night.jpg',
        fit: 'cover',
        effectsEnabled: true,
        reducedMotion: false,
        animationSpeed: 1.0 // factor multiplicador (1 = normal)
      }, init);
    }
    /**
     * Retrieves the value associated with the specified key from the state.
     *
     * @param {string} key - The key whose associated value is to be returned.
     * @return {*} The value associated with the given key, or undefined if the key does not exist.
     */
    get(key){ return this.state[key]; }
    /**
     * Sets a value in the state object with the specified key and returns a snapshot of the updated state.
     *
     * @param {string} key - The key to associate with the value in the state object.
     * @param {*} val - The value to be set for the specified key in the state object.
     * @return {Object} A snapshot of the updated state after the key-value pair has been set.
     */
    set(key, val){ this.state[key] = val; return this.snapshot(); }
    /**
     * Toggles the boolean value associated with the given key in the state object.
     * If the current value is true, it will be set to false, and vice versa.
     *
     * @param {string} key - The key in the state object whose value is to be toggled.
     * @return {Object} The current snapshot of the updated state object.
     */
    toggle(key){ this.state[key] = !this.state[key]; return this.snapshot(); }
    /**
     * Creates a snapshot of the current state.
     *
     * @return {Object} A shallow clone of the current state.
     */
    snapshot(){ return {...this.state}; }
  }

  /**
   * Manages the lifecycle and execution of various registered effects.
   *
   * The EffectManager class provides functionality to register, unregister, and play
   * effects. It communicates with a provided event bus, manages state dependencies,
   * and logs telemetry data related to effect execution.
   */
  class EffectManager {
    /**
     * Creates an instance of the class with the specified dependencies and initializes internal properties.
     *
     * @param {Object} options An object containing the required dependencies.
     * @param {Object} options.bus The bus object used for communication or event handling.
     * @param {Object} options.state The state management object used for storing or managing state data.
     * @param {Object} options.telemetry The telemetry object used for logging or monitoring data.
     * @return {void} Does not return a value.
     */
    constructor({ bus, state, telemetry }){
      this.bus = bus; this.state = state; this.telemetry = telemetry;
      this.registry = new Map();
    }
    /**
     * Registers a handler associated with a specific type.
     *
     * @param {string} type - The type for which the handler is being registered.
     * @param {Function} handler - The function to handle the specified type.
     * @return {void}
     */
    register(type, handler){ this.registry.set(type, handler); }
    /**
     * Unregisters a specified type from the registry.
     *
     * @param {string} type - The key representing the type to be removed from the registry.
     * @return {boolean} Returns true if the type was successfully deleted, false otherwise.
     */
    unregister(type){ this.registry.delete(type); }
    /**
     * Executes an effect registered within the system, adjusting its behavior based on state configurations.
     *
     * @param {string} type - The type of effect to be played, which must be registered in the registry.
     * @param {Object} ctx - The context object containing necessary data for the effect execution.
     * @param {string} [ctx.id] - The identifier for the target associated with the effect.
     * @return {Promise<void>} Resolves when the effect is successfully executed.
     */
    async play(type, ctx){
      if(!this.registry.has(type)) return;
      const start = performance.now();
      this.bus?.emit('effect.start', { type, target: ctx?.id });
      const factor = (this.state.get('reducedMotion') ? 0.01 : (this.state.get('animationSpeed')||1));
      await this.registry.get(type)({
        ...ctx,
        state: this.state.snapshot(),
        speed: factor
      });
      const dur = performance.now() - start;
      this.bus?.emit('effect.end', { type, target: ctx?.id, duration: dur });
      this.telemetry?.cta?.('effect', { name:type, duration: Math.round(dur) });
    }
  }

  /* ------- Efectos por defecto (MVP) ------- */
  /**
   * A private asynchronous function that waits for two animation frames before resolving a Promise.
   *
   * This function uses the `requestAnimationFrame` Web API to delay execution until two consecutive
   * animation frame requests have occurred. It is typically used to ensure that DOM updates
   * have been applied and rendered before executing subsequent logic.
   *
   * @returns {Promise<void>} A promise that resolves after two animation frames.
   * @private
   */
  const _nextFrame = () => new Promise(r=>requestAnimationFrame(()=>requestAnimationFrame(r)));
  /**
   * Handles the addition and removal of CSS classes on a specified element
   * and waits for the next animation frame.
   *
   * @param {HTMLElement} el - The target HTML element to modify classes for.
   * @param {string} add - The name of the CSS class to add to the target element.
   * @param {string[]} [remove=[]] - An optional array of CSS class names to remove from the target element.
   * @returns {Promise<void>} Resolves after the next animation frame.
   */
  const _withClass = async (el, add, remove=[]) => {
    if(!el) return;
    remove.forEach(c=>el.classList.remove(c));
    el.classList.add(add);
    await _nextFrame();
  };
  /**
   * Awaits the completion of a CSS transition on an element or resolves after a timeout.
   *
   * This function listens for the `transitionend` event on the provided element to detect
   * when its CSS transition has completed. If the event does not occur within the specified
   * timeout period, the promise resolves automatically.
   *
   * @param {HTMLElement} el - The target HTML element to monitor for the `transitionend` event.
   * @param {number} [timeout=320] - The timeout duration in milliseconds to wait for the transition to complete.
   * @returns {Promise<void>} A promise that resolves when the transition ends or the timeout elapses.
   */
  const _awaitTransition = (el, timeout=320) => new Promise(resolve => {
    if(!el) return resolve();
    let done=false;
    const to = setTimeout(()=>{ if(!done){ done=true; resolve(); } }, timeout+40);
    const onEnd = (e)=>{ if(e.target!==el) return; if(!done){ done=true; clearTimeout(to); el.removeEventListener('transitionend', onEnd); resolve(); } };
    el.addEventListener('transitionend', onEnd, { once:true });
  });

  /**
   * Registers a set of default visual and motion effects to the provided effect manager instance.
   * Each effect is added to handle transitions, animations, material designs, feedback, and ambient interactions.
   * These effects allow for dynamic element state transitions and user interaction responses.
   *
   * @param {Object} effectManager - The effect manager instance where the default effects are registered.
   * @return {void} - This function does not return anything.
   */
  function registerDefaultEffects(effectManager){
    // TransiciÃ³n: abrir
    effectManager.register('transition:open', async ({ element, speed=1 })=>{
      if(!element) return;
      element.classList.add('is-opening');
      await _nextFrame();
      element.classList.add('is-open');
      element.classList.remove('is-opening');
      await _awaitTransition(element, 240 / speed);
    });

    // TransiciÃ³n: cerrar
    effectManager.register('transition:close', async ({ element, speed=1 })=>{
      if(!element) return;
      element.classList.add('is-closing');
      element.classList.remove('is-open');
      await _awaitTransition(element, 240 / speed);
      // Cleanup aunque el DOM se vaya a retirar
      element.classList.remove('is-closing');
    });

    // TransiciÃ³n: minimizar (cierra visualmente y deja el DOM limpio para restore)
    effectManager.register('transition:minimize', async ({ element, speed=1 })=>{
      if(!element) return;
      element.classList.add('is-closing');
      element.classList.remove('is-open');
      await _awaitTransition(element, 220 / speed);
      // ðŸ”§ CLAVE: limpiar estado para que restore no quede transparente
      element.classList.remove('is-closing');
    });

    // TransiciÃ³n: restore (de estado visible pero sin 'is-open' â†’ a abierto)
    effectManager.register('transition:restore', async ({ element, speed=1 })=>{
      if(!element) return;
      element.classList.remove('is-closing');
      // Punto de partida sin salto
      element.style.willChange = 'opacity, transform';
      element.style.opacity = '0';
      element.style.transform = 'scale(.98)';
      await _nextFrame();
      element.classList.add('is-open');
      element.style.opacity = '';
      element.style.transform = '';
      await _awaitTransition(element, 200 / speed);
      element.style.willChange = '';
    });

    // Material: sombra segÃºn foco
    effectManager.register('material:shadow:weak', async ({ element })=>{
      if(!element) return;
      element.classList.add('has-shadow-weak');
      element.classList.remove('has-shadow-strong');
    });
    effectManager.register('material:shadow:strong', async ({ element })=>{
      if(!element) return;
      element.classList.add('has-shadow-strong');
      element.classList.remove('has-shadow-weak');
    });

    // Motion: minimize hacia taskbar (FLIP)
    effectManager.register('motion:to-taskbar', async ({ id, element, speed=1, getTaskEl })=>{
      if(!element) return;
      const taskEl = getTaskEl?.(id);
      if(!taskEl) return; // fallback: no animar si no hay task

      const from = element.getBoundingClientRect();
      const to = taskEl.getBoundingClientRect();
      const dx = (to.left + to.width/2) - (from.left + from.width/2);
      const dy = (to.top + to.height/2) - (from.top + from.height/2);
      const s  = Math.max(0.08, Math.min(0.12, (to.width/from.width))); // escala pequeÃ±a

      element.classList.add('fly');
      element.style.transformOrigin = 'center center';
      element.style.transform = `translate(${dx}px, ${dy}px) scale(${s})`;
      element.style.opacity = '0';
      await _awaitTransition(element, 220 / speed);
      // cleanup
      element.classList.remove('fly');
      element.style.transform = '';
      element.style.opacity = '';
    });

    // Feedback: shake para acciones invÃ¡lidas
    effectManager.register('feedback:shake', async ({ element })=>{
      if(!element) return;
      element.classList.add('shake');
      await _awaitTransition(element, 280);
      element.classList.remove('shake');
    });

    // Attention: pulse en task
    effectManager.register('attention:task', async ({ id, getTaskEl })=>{
      const el = getTaskEl?.(id); if(!el) return;
      el.classList.add('attention');
      await _awaitTransition(el, 1200*2);
      el.classList.remove('attention');
    });

    // Attention: pulse en ventana
    effectManager.register('attention:window', async ({ element })=>{
      if(!element) return;
      element.classList.add('attention');
      await _awaitTransition(element, 1200*2);
      element.classList.remove('attention');
    });

    effectManager.register('compositor:glass-toggle', async ({ elementList=[], glass })=>{
      for (const el of elementList) {
        if(!el) continue;
        el.style.willChange = 'backdrop-filter, background';
      }
      await _nextFrame();
      for (const el of elementList) el.style.willChange = '';
    });

    effectManager.register('ambient:parallax', ({ root })=>{
      if(!root) return;
      root.classList.add('parallax');
      const onMove = (e)=>{
        const x = (e.clientX / window.innerWidth)  * 10; // 0â€“10%
        const y = (e.clientY / window.innerHeight) * 10; // 0â€“10%
        root.style.backgroundPosition = `calc(50% + ${x}px) calc(50% + ${y}px), center, center`;
      };
      root.__parallaxMove = onMove;
      window.addEventListener('mousemove', onMove);
    });

    effectManager.register('ambient:parallax:off', ({ root })=>{
      if(!root) return;
      window.removeEventListener('mousemove', root.__parallaxMove);
      root.classList.remove('parallax');
      root.style.backgroundPosition = 'center, center, center';
    });
  }

  /**
   * Compositor: orquesta efectos en respuesta a eventos del WindowManager a travÃ©s del EventBus.
   * Mantiene flags expuestos al template (glass/wallpaper/fit) vÃ­a proxy a StateManager.
   */
  class Compositor {
    constructor({ bus, stateManager, effectManager }){
      this._bus = bus;
      this._state = stateManager;
      this._effects = effectManager;

      // Exponer como propiedades "reactivas" que ya usa el template
      this.glass = this._state.get('glass');
      this.wallpaper = this._state.get('wallpaper');
      this.fit = this._state.get('fit');

      registerDefaultEffects(this._effects);
      this._bind();
    }

    /**
     * Binds a series of event listeners to the `_bus` event bus for handling
     * various window lifecycle events such as open, close, minimize, focus, blur,
     * and others. Each event handler performs relevant actions such as applying
     * visual effects, calling completion callbacks, or toggling compositor states.
     *
     * @return {void} This method does not return a value.
     */
    _bind(){
      this._bus.on('window.opened', async ({ id })=>{
        const el = this._getEl(id);
        if(!el) return;
        await this._effects.play('transition:open', { id, element: el });
        await this._effects.play('material:shadow:strong', { id, element: el });
      });

      this._bus.on('window.closing', async ({ id, onDone })=>{
        const el = this._getEl(id);
        if(el) await this._effects.play('transition:close', { id, element: el });
        onDone?.();
      });

      this._bus.on('window.minimizing', async ({ id, onDone })=>{
        const el = this._getEl(id);
        if(el) await this._effects.play('transition:minimize', { id, element: el });
        onDone?.();
      });

      this._bus.on('window.focus', async ({ id })=>{
        const el = this._getEl(id); if(!el) return;
        await this._effects.play('material:shadow:strong', { id, element: el });
      });
      this._bus.on('window.blur', async ({ id })=>{
        const el = this._getEl(id); if(!el) return;
        await this._effects.play('material:shadow:weak', { id, element: el });
      });

      this._bus.on('window.restored', async ({ id })=>{
        const el = this._getEl(id); if(!el) return;
        el.classList.remove('is-closing');
        el.classList.add('is-open');
        await this._effects.play('material:shadow:strong', { id, element: el });
      });

      this._bus.on('compositor.toggleGlass', ()=>{
        const snap = this._state.toggle('glass');
        this.glass = snap.glass;
      });
    }

    /**
     * Retrieves an element from the DOM based on a specified window ID.
     *
     * @param {string} id - The unique identifier associated with the desired DOM element.
     * @return {Element*/
    _getEl(id){ return document.querySelector(`.window[data-win-id="${id}"]`); }

    /**
     * Toggles the glass effect by emitting an event through the compositor.
     * This method signals the compositor to enable or disable the glass effect.
     *
     * @return {void} Does not return a value.
     */
    toggleGlass(){ this._bus.emit('compositor.toggleGlass'); }
    setWallpaper(url){ const s=this._state.set('wallpaper', url); this.wallpaper = s.wallpaper; }
    setFit(mode){ const s=this._state.set('fit', mode); this.fit = s.fit; }
  }

  /* Content components (simple, static for MVP) */
  /**
   * About component configuration object.
   *
   * This object defines the properties and template for the About component.
   * It includes a set of properties to be passed, such as translations, and renders
   * an informational grid-style section with key details including role, location,
   * languages, value proposition, and current technical focus areas.
   *
   * Properties:
   * - `props`: An array of properties that the component expects. In this case, it expects `t`, a translation function.
   *
   * Template Output:
   * - A grid structure displaying an about section for a Tech Lead / Architect role.
   * - Contains details such as the role, location, languages, value proposition, and current training or projects.
   * - Includes styling classes such as "grid", "muted", and "hr" for layout and presentation purposes.
   */
  const About = {
    props:['t'],
    template:`
      <section class="about">
        <header class="about-header">
          <div class="about-avatar"></div>
          <div>
            <h2 class="about-name">{{ t('about.title')}}</h2>
            <p class="about-summary">{{ t('about.summary') }}</p>
          </div>
        </header>
        <div class="hr"></div>
        <article class="about-body">
          <p>{{ t('about.profile') }}</p>
        </article>
        <section class="about-info grid cols-2">
          <div class="about-col">
            <p><strong>{{ t('about.location') }}</strong><br><span class="muted">{{ t('about.languages') }}</span></p>
          </div>
          <div class="about-col">
            <p><strong>{{ t('about.value').split(':')[0] }}:</strong> <span class="muted">{{ t('about.value').split(':')[1] }}</span></p>
          </div>
          <div class="about-col">
            <p>{{ t('about.role_now') }}</p>
          </div>
          <div class="about-col">
            <p><strong>Soft Skills:</strong> <span class="muted">{{ t('about.softskills') }}</span></p>
          </div>
        </section>
      </section>
    `
  };

  /**
   * A Vue.js component representing professional experience details.
   *
   * The `Experience` component is a reusable Vue.js component designed to display professional
   * experience details with titles, company names, roles, durations, and key achievements.
   *
   * Properties:
   * - `t {Function}`: A function used for localization or translation of content within the component, such as section titles.
   *
   * Template:
   * - Displays a localized title using the `t` function.
   * - Lists professional experiences, including:
   *   * Role titles, company names, and employment periods.
   *   * Relevant achievements and work performed for each position.
   *
   * Usage Context:
   * - Designed to be included in applications requiring a structured display of extensive experience details, e.g., resumes, CV templates, or professional portfolios.
   */
  const Experience = {
    props:['t'],
    template: `
      <section class="experience">
        <h2 class="exp-title">{{ t('experience.title') }}</h2>

        <article class="exp-card">
          <header>
            <h3>Nyx Software y TecnologÃ­a</h3>
            <p class="role">Senior Software Engineer / Team Lead <span class="period">(Ago 2023â€“Presente)</span></p>
          </header>
          <ul>
            <li>Liderazgo transversal en arquitectura, infraestructura, datos y QA.</li>
            <li>ReducciÃ³n del 70% en bugs crÃ­ticos y estabilizaciÃ³n del backlog.</li>
            <li>DiseÃ±o de reportes y relaciones en DocumentDB para analÃ­tica externa.</li>
            <li>CreaciÃ³n de sistema estandarizado de landing pages con integraciÃ³n analÃ­tica.</li>
            <li>OptimizaciÃ³n de costos y escalabilidad en AWS (CloudFront/S3, IAM).</li>
          </ul>
        </article>

        <article class="exp-card">
          <header>
            <h3>VASS Chile</h3>
            <p class="role">Senior Software Engineer (Magento) <span class="period">(Nov 2020â€“Jul 2023)</span></p>
          </header>
          <ul>
            <li>MigraciÃ³n de TelefÃ³nica Chile de Magento 2.2 a 2.4 con integraciones crÃ­ticas.</li>
            <li>Desarrollo de mÃ³dulos de pago e interfaces en Magento 2.</li>
            <li>ReducciÃ³n de hallazgos en Kiuwan mediante estÃ¡ndares de cÃ³digo y guÃ­as internas.</li>
          </ul>
        </article>

        <article class="exp-card">
          <header>
            <h3>PagoFÃ¡cil</h3>
            <p class="role">Software Engineer Sr (Magento) <span class="period">(Oct 2019â€“Feb 2020)</span></p>
          </header>
          <ul>
            <li>ImplementaciÃ³n de gateway de pagos para Magento 2.3 con PagofÃ¡cil.</li>
          </ul>
        </article>

        <article class="exp-card">
          <header>
            <h3>ENOVA MÃ©xico</h3>
            <p class="role">Software Engineer Sr / Project Manager Jr <span class="period">(Oct 2017â€“Abr 2019)</span></p>
          </header>
          <ul>
            <li>ImplementaciÃ³n de facturaciÃ³n CFDI 3.3 en Mako.</li>
            <li>Establecimiento de Scrum; reducciÃ³n del 80% en tickets de error.</li>
            <li>PublicaciÃ³n de paquetes en Packagist y herramientas internas en Python.</li>
          </ul>
        </article>

        <article class="exp-card">
          <header>
            <h3>Nyx Software and Technology</h3>
            <p class="role">CTO / Software Engineer Sr <span class="period">(Abr 2016â€“Ago 2017)</span></p>
          </header>
          <ul>
            <li>MigraciÃ³n Python 2.7â†’3.5 y Django 1.6â†’1.10.</li>
            <li>AdopciÃ³n de Gitflow y prÃ¡cticas Ã¡giles.</li>
          </ul>
        </article>

        <article class="exp-card">
          <header>
            <h3>Otros roles (2011â€“2016)</h3>
            <p class="role muted">AMK Technologies (Sin Delantal), Gameplanet, Grupo ExpansiÃ³n, Linio, INE, INTELIGLOBE, ITSkill, Javanes.</p>
          </header>
        </article>
      </section>
    `
  };

  /**
   * Vue.js component that represents a section showcasing various skills and expertise.
   *
   * This component is used to display categorized professional skills and tools,
   * including programming languages, frameworks, databases, cloud infrastructure,
   * software architectures, and system-related expertise.
   *
   * Properties:
   * - `props`: An array containing a single prop `t`, which is a function used for translations.
   *
   * Structure:
   * - The component consists of a title and a grid layout with two columns.
   * - The left column lists programming languages, frameworks, and database technologies.
   * - The right column lists cloud infrastructure, architectural patterns, and system tools.
   *
   * Features:
   * - Dynamically renders a translated title using the `t` function provided via props.
   * - Organized information with semantic tags for better readability.
   * - Highlights key skills and technologies with bold text to improve visibility.
   */
  const Skills = {
    props:['t'],
    template: `
      <section class="skills">
        <h2 class="skills-title">{{ t('skills.title') }}</h2>
        <div class="skills-grid">
          <div class="skills-col">
            <div class="skills-block">
              <h3>Backend</h3>
              <p>Python Â· PHP Â· .NET Core Â· Node.js</p>
            </div>
            <div class="skills-block">
              <h3>Bases de datos</h3>
              <p>DocumentDB / MongoDB Â· MySQL</p>
            </div>
            <div class="skills-block">
              <h3>Frontend</h3>
              <p>Angular (mantenimiento) Â· JavaScript</p>
            </div>
          </div>

          <div class="skills-col">
            <div class="skills-block">
              <h3>Cloud / DevOps</h3>
              <p>AWS (Lambda, S3/CloudFront, RDS, DocumentDB, EC2) Â· Docker Â· CI/CD</p>
            </div>
            <div class="skills-block">
              <h3>Procesos</h3>
              <p>Liderazgo tÃ©cnico Â· Scrum / Kanban Â· Code Reviews Â· PolÃ­ticas y procedimientos</p>
            </div>
            <div class="skills-block">
              <h3>EstÃ¡ndares</h3>
              <p>PSR Â· RFC 2119 Â· Gitflow</p>
            </div>
          </div>
        </div>
      </section>
    `
  };

  /**
   * Represents an education component that displays details about formal education,
   * additional training, and ongoing courses.
   *
   * @property {Array} props - An array containing properties passed to the component. Here, it includes `t`, a translation function.
   * @property {String} template - A string defining the HTML structure of the education component. It includes information about
   * educational qualifications, complementary courses, and current learning endeavors.
   */
  const Education = {
    props:['t'],
    template:`
      <section class="education">
        <h2 class="edu-title">{{ t('education.title') }}</h2>

        <article class="edu-block">
          <header>
            <h3>Ing. en Sistemas Computacionales</h3>
            <p class="edu-meta">MÃ©xico Â· TitulaciÃ³n completa</p>
          </header>
          <p class="edu-detail">Base acadÃ©mica en ingenierÃ­a de software, estructuras de datos y sistemas distribuidos.</p>
        </article>

        <article class="edu-block">
          <header>
            <h3>FormaciÃ³n complementaria</h3>
          </header>
          <ul class="edu-list">
            <li>PMBOK 7</li>
            <li>Lean Delivery</li>
            <li>DevOps</li>
            <li>Conflict Management</li>
            <li>Leadership for Tech Teams</li>
          </ul>
        </article>

        <article class="edu-block">
          <header>
            <h3>En curso</h3>
          </header>
          <p class="edu-detail">Kubernetes â†’ OpenShift y actualizaciÃ³n avanzada de PHP / Python / Java.</p>
        </article>
      </section>
    `
  };

  /**
   * Download is a Vue component that provides downloadable and viewable resources, such as a CV, along with links to external social media or personal pages.
   *
   * @property {Array<string>} props - Accepts a single prop `t` which is a function used for localization of UI text.
   *
   * @emits {string} open-viewer - Triggered when the "Ver CV" link is clicked. Emits an object with `src`, `type`, and `title` properties.
   * @emits {string} download - Triggered when the "CV â€” PDF" link is clicked to download the file.
   *
   * @template A Vue template structure that includes:
   * - A title and hint section, both localized using the `t` prop.
   * - Links for downloading or viewing a CV.
   * - A section with links to external platforms such as LinkedIn, GitHub, and a blog.
   */
  const Download = {
    props:['t'],
    emits:['open-viewer','download'],
    template:`
      <section class="download">
        <header class="download-header">
          <h2 class="download-title">{{ t('download.title') }}</h2>
          <p class="muted">{{ t('download.hint') }}</p>
        </header>

        <div class="download-actions">
          <a class="btn-download" href="/cv/angel-barrientos.pdf" download
             @click="$emit('download')">â¬‡ Descargar CV (PDF)</a>

          <button class="btn-view"
                  @click.prevent="$emit('open-viewer',{src:'/cv/angel-barrientos.pdf',type:'pdf',title:'CV de Angel'})">
            ðŸ—Ž Ver CV en visor
          </button>
        </div>

        <div class="hr"></div>

        <footer class="download-footer">
          <nav>
            <a class="link" href="https://linkedin.com/in/uetiko" target="_blank" rel="noopener">LinkedIn</a>
            <span>Â·</span>
            <a class="link" href="https://github.com/uetiko" target="_blank" rel="noopener">GitHub</a>
            <span>Â·</span>
            <a class="link" href="https://blog.uetiko.com" target="_blank" rel="noopener">Blog</a>
          </nav>
        </footer>
      </section>
    `
  };

  /**
   * A Vue.js component representing a contact form.
   *
   * The `Contact` component provides a simple contact form with fields for name, email, and message.
   * It includes a title fetched dynamically using a translation function, a styled email link,
   * and a submission handler for emitting form data upon user submission.
   *
   * Properties:
   * - `props`: An array containing property names used by the component. Currently includes:
   *   - `t`: A function used for dynamic text translation.
   *
   * Template:
   * - The template includes:
   *   - A title, which is dynamically rendered using the `t` function.
   *   - An email contact link.
   *   - A form with:
   *     - Two input fields (`name` and `email`) styled for user input.
   *     - A textarea for entering a message.
   *     - A submit button triggering a `submit` event with form status and ID upon submission.
   *
   * Events:
   * - `submit`: Emitted when the form is submitted. The payload contains:
   *   - `form_id`: The identifier of the form.
   *   - `status`: The submission status, defaulting to 'ok'.
   */
  const Contact = {
    props:['t'],
    template:`
      <section class="contact">
        <h2 class="contact-title">{{ t('contact.title') }}</h2>

        <div class="contact-card">
          <div class="contact-row">
            <span class="contact-icon">ðŸ“§</span>
            <a class="contact-link" href="mailto:uetiko@gmail.com">uetiko@gmail.com</a>
          </div>

          <div class="contact-row">
            <span class="contact-icon">ðŸŒ</span>
            <a class="contact-link" href="https://linkedin.com/in/uetiko" target="_blank" rel="noopener">LinkedIn</a>
            <span>Â·</span>
            <a class="contact-link" href="https://github.com/uetiko" target="_blank" rel="noopener">GitHub</a>
            <span>Â·</span>
            <a class="contact-link" href="https://blog.uetiko.com" target="_blank" rel="noopener">Blog</a>
          </div>
        </div>

        <div class="hr"></div>

        <p class="muted contact-footnote">
          Si deseas colaborar o tienes un proyecto interesante, no dudes en escribirme.
        </p>
      </section>
    `
  };

  /**
   * DocumentViewer is a component that displays a document passed via the `src` property.
   * It supports different file types such as images or PDFs and adapts its rendering logic based on the type.
   * Additionally, it provides telemetry functionalities for tracking user interactions like downloads and window state changes.
   *
   * Props:
   * @prop {string} src - The source URL of the document to be displayed. This should be a valid URL pointing to a file.
   * @prop {string} type - The type of the document to be displayed. It accepts 'image', 'pdf', or other supported types.
   * @prop {string} title - The title of the document, displayed at the top of the viewer.
   * @prop {Object} telemetry - An object for managing telemetry events. It must have methods `download`, `openWindow`, and `closeWindow`.
   *
   * Behavior:
   * - Renders the document inside the component area based on its type. For example:
   *   - Renders an `<img>` tag for image files.
   *   - Renders an `<iframe>` tag for PDFs or other types.
   * - Displays a download link that allows users to download the document. A `telemetry.download` event is triggered on download.
   * - Tracks when the viewer is mounted and unmounted using `telemetry.openWindow` and `telemetry.closeWindow` respectively.
   *
   * Styling:
   * - Uses a flexbox layout for managing the title bar and download link.
   * - Ensures responsive behavior by creating a grid layout with an auto header and an expandable document viewing area.
   */
  const DocumentViewer = {
    props: ['src', 'type', 'title', 'telemetry'],
    template: `
      <section class="doc-viewer">
        <header class="doc-header">
          <h3 class="doc-title">{{ title }}</h3>
          <div class="doc-actions">
            <a class="btn-doc" :href="src" download
               @click="telemetry.download({file_name: src.split('/').pop(), element:'download_link'})">
              â¬‡ Descargar
            </a>
          </div>
        </header>

        <div class="doc-frame">
          <component :is="componentType" :src="src" class="doc-content" />
        </div>
      </section>
    `,
    computed: {
      componentType() {
        switch (this.type) {
          case 'image': return 'img';
          case 'pdf': return 'iframe';
          default: return 'iframe';
        }
      }
    },
    mounted() {
      this.telemetry.openWindow('document_viewer', {file: this.src, type: this.type});
    },
    unmounted() {
      this.telemetry.closeWindow('document_viewer', {file: this.src});
    }
  };

  const ProjectsBadges = {
    props:['t'],
    template: `
      <article>
        <h2>{{ t('projects.title') }}</h2>
        <div class="projects-grid">
          <section class="project-group">
            <h3>tiempo total de codificaciÃ³n</h3>
            <div class="project-list">
              <div class="project">
                <a href="https://wakatime.com/@8a272fcb-113b-4d48-b227-e717ab94571a"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a.svg" alt="Total time coded since Feb 11 2015" /></a>
              </div>
            </div>
          </section>
          <section class="project-group">
            <h3>Stoyco</h3>
            <div class="project-list">
              <div class="project">
                <h4>Landing Eladio</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/6d2cd5d8-2d27-4977-ad44-6156cd050b9c"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/6d2cd5d8-2d27-4977-ad44-6156cd050b9c.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Stoyco AWS Console</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/be7a8e5d-2037-4ab7-adf9-a1eb4d27cd91"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/be7a8e5d-2037-4ab7-adf9-a1eb4d27cd91.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>admisistraciÃ³n y reportes en base de datos </h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/018e77ba-493c-468d-bca0-8bc28233c079"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/018e77ba-493c-468d-bca0-8bc28233c079.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Scripts varios (nodejs)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/acbf0d75-3e83-4a08-a5f5-c34b0bbcb68f"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/acbf0d75-3e83-4a08-a5f5-c34b0bbcb68f.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Core (.net core 6)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/018e1b6f-dae8-4cb3-aa67-5dadc962c57d"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/018e1b6f-dae8-4cb3-aa67-5dadc962c57d.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Micro servicio Usuario (nodejs)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/0787bcd2-6c67-42e7-bacd-332ab40adc90"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/0787bcd2-6c67-42e7-bacd-332ab40adc90.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Backoffice (mantenimiento de errores criticos, Nodejs)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/018e3e0a-25c5-45f6-9d17-7f6799e24ee0"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/018e3e0a-25c5-45f6-9d17-7f6799e24ee0.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Queue multi propocito (follows, reports, mailchimp)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/0fcc38b9-2d7f-49ee-b5c0-ffa536c37fe3"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/0fcc38b9-2d7f-49ee-b5c0-ffa536c37fe3.svg" alt="wakatime"></a>
              </div>
            </div>
          </section>
          <section class="project-group">
            <h3>City Express (hoteles)</h3>
            <div class="project-list">
              <div class="project">
                <h4>Channel Manager Backend (fastApi)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/cf4a7486-e86c-48be-aa66-5287f23a4e40"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/cf4a7486-e86c-48be-aa66-5287f23a4e40.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Channel Manager Frontend (Svelt)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/ef7e5e89-6788-4f38-82e7-67f4f5c546eb"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/ef7e5e89-6788-4f38-82e7-67f4f5c546eb.svg" alt="wakatime"></a>
              </div>
            </div>
          </section>
          <section class="project-group">
            <h3>Vass</h3>
            <div class="project-list">
              <div class="project">
                <h4>wiki</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/ed56c836-1a05-4d96-9bba-3d1461326bca"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/ed56c836-1a05-4d96-9bba-3d1461326bca.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Magento (telefonica chile)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/5b0b8537-7c4a-40d3-a782-d72f25d9820e"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/5b0b8537-7c4a-40d3-a782-d72f25d9820e.svg" alt="wakatime"></a>
              </div>
              <div class="project">
                <h4>Banco Estado (Symphony)</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/3b9407cd-283b-4dce-a6a9-d86392b100f2"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/3b9407cd-283b-4dce-a6a9-d86392b100f2.svg" alt="wakatime"></a>
              </div>
            </div>
          </section>
          <section class="project-group">
            <h3>Enova</h3>
            <div class="project-list">
              <div class="project">
                <h4>Mako</h4>
                <a href="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/3caf4d19-3057-4614-b57f-69a9a347eaaa"><img src="https://wakatime.com/badge/user/8a272fcb-113b-4d48-b227-e717ab94571a/project/3caf4d19-3057-4614-b57f-69a9a347eaaa.svg" alt="wakatime"></a>
              </div>
            </div>
          </section>
        </div>
      </article>
    `
  };

  const { createApp, onMounted, ref, reactive, computed } = Vue;

  /**
   * Represents the main application instance created via `createApp` function with setup logic.
   *
   * This variable encompasses a Vue application instance configured with its components, reactive state management,
   * event handling, window management, and telemetry integration.
   *
   * Components included:
   * - About
   * - Experience
   * - Skills
   * - Education
   * - Download
   * - Contact
   * - DocumentViewer
   *
   * The setup function initializes and configures several key functionalities such as:
   * - Language detection and i18n handling.
   * - Telemetry for tracking user interactions and page views.
   * - Window management system for creating, focusing, minimizing, restoring, resizing, and closing windows.
   * - Event bus for inter-component communication.
   * - Media query handling for preferences like reduced motion.
   * - Reactive state objects for maintaining UI state, windows, tasks, and effects.
   * - Drag-and-drop and resizing interactions for UI elements.
   *
   * The setup also includes various utility methods like `makeWin`, `focus`, `openApp`, and event-specific handlers
   * (e.g., `startDrag`, `onDrag`, `endDrag`) to enhance and manage app interactions dynamically.
   */
  const app = createApp({
    components: { About, Experience, Skills, Education, Download, Contact, DocumentViewer, ProjectsBadges },
    setup() {
      const env = (new URLSearchParams(location.search).get('env')) || 'live';
      const appName = 'desktop';
      const lang = ref((navigator.language || 'es').startsWith('es') ? 'es' : 'en');
      const t = (key) => i18n(lang.value)(key);

      const telemetry = new Telemetry({ env, app: appName });
      telemetry.pageView();

      const wm = new WindowManager();
      const bus = new EventBus();
      const mq = matchMedia('(prefers-reduced-motion: reduce)');
      const stateManager = new StateManager({
        glass: true,
        animationSpeed: 1.0,
        reducedMotion: mq.matches
      });
      const effectManager = new EffectManager({ bus, state: stateManager, telemetry });
      const compositor = reactive(new Compositor({ bus, stateManager, effectManager }));

      const windows = reactive([]);
      const tasks = reactive([]);

      /**
       * Creates and manages the lifecycle of a new window instance.
       *
       * This function is responsible for creating new windows, restoring
       * existing ones if they are already opened, and managing associated
       * tasks and event emissions.
       *
       * @param {string} id - A unique identifier for the window instance.
       * @param {string} title - The title to display in the window.
       * @param {string} icon - The path or key for the icon to display with the window.
       * @param {Function} component - The component or function to render within the window.
       * @param {Object} [props={}] - Optional props passed to the component for customization.
       */
      const makeWin = (id, title, icon, component, props = {}) => {
        if (wm.find(id)) { wm.restore(id); focus(id); return; }
        const w = wm.create({ id, title, icon, component });
        windows.push({ id, title, icon, component, props, get style(){ return wm.style(w); } });
        tasks.push({ id, title, active: true });
        focus(id);
        requestAnimationFrame(()=> bus.emit('window.opened', { id }));
      };

      /**
       * Opens a new document viewer window for displaying a file.
       *
       * @function
       * @param {Object} payload - The payload containing file details for the viewer.
       * @param {string} payload.src - The source path or URL of the document to be viewed.
       * @param {string} payload.type - The type or format of the document (e.g., PDF, image).
       * @param {string} payload.title - The title to be displayed on the viewer window.
       */
      const openViewer = (payload) => {
        const { src, type, title } = payload;
        const id = `viewer-${uuidv4()}`;
        makeWin(id, title, 'ðŸ—Ž', 'DocumentViewer', { src, type, title, telemetry });
        telemetry.openWindow('document_viewer', {file: src, type});
      };

      /**
       * Changes the focus to a specific task by its ID.
       *
       * When a task gains focus, the previously focused task is blurred if present,
       * and the focus event is emitted. It updates the task's `active` state and notifies
       * with appropriate events.
       *
       * @param {string} id - The identifier of the task to focus.
       */
      const focus = (id) => {
        const prev = tasks.find(t=>t.active);
        if(prev && prev.id !== id) bus.emit('window.blur', { id: prev.id });
        wm.focus(id);
        tasks.forEach(t=>t.active = (t.id===id));
        bus.emit('window.focus', { id });
      };
      /**
       * Minimizes a window identified by the given ID.
       *
       * The function emits a 'window.minimizing' event via the bus with the window ID
       * and an "onDone" callback. Once the "onDone" callback is triggered, the window
       * is minimized using the window manager and its corresponding task is marked
       * as inactive if found in the task list.
       *
       * @param {string} id - The unique identifier of the window to be minimized.
       */
      const minimize = (id) => {
        bus.emit('window.minimizing', {
          id,
          onDone: () => {
            wm.minimize(id);
            const t = tasks.find(t=>t.id===id); if(t) t.active = false;
          }
        });
      };
      /**
       * Restores a window or task identified by the given ID.
       *
       * This function performs the following actions:
       * 1. Calls the `restore` method from the `wm` module to restore the window.
       * 2. Finds the task associated with the provided ID and marks it as active.
       * 3. Emits the `window.restored` event with the associated ID.
       * 4. Emits the `window.focus` event with the associated ID.
       *
       * @param {string|number} id - The unique identifier of the window or task to restore.
       */
      const restore = (id) => {
        wm.restore(id);
        const t = tasks.find(t=>t.id===id); if(t) t.active = true;
        bus.emit('window.restored', { id });   // ðŸ‘ˆ nuevo
        bus.emit('window.focus', { id });
      };
      const toggleMaximize = (id) => {
        wm.toggleMax(id);
        wm.syncToDOM(id);
        bus.emit('window.maximized', { id });
      };
      /**
       * Closes a window and performs associated cleanup operations.
       *
       * Emits a 'window.closing' event with the specified window ID and provides a callback
       * to clean up resources and update the state by removing the window and its
       * corresponding task entry from their respective lists.
       *
       * @param {string} id - The identifier of the window to be closed.
       */
      const closeWindow = (id) => {
        bus.emit('window.closing', {
          id,
          onDone: () => {
            wm.close(id);
            const idx = windows.findIndex(w=>w.id===id); if(idx>-1) windows.splice(idx,1);
            const tidx = tasks.findIndex(t=>t.id===id); if(tidx>-1) tasks.splice(tidx,1);
          }
        });
      };

      /**
       * Opens a specified application window based on the provided name.
       *
       * Depending on the name parameter, the function triggers the creation of a new application
       * window with predefined attributes such as ID, title, icon, and additional content descriptor.
       * It also logs a telemetry event for tracking purposes.
       *
       * @param {string} name - The name of the application to open. Accepted values are:
       *                        'about', 'experience', 'skills', 'education', 'download', 'contact'.
       *                        Each corresponds to a specific application window.
       * @throws {Error} If no matching case is found for the provided name.
       */
      const openApp = (name) => {
        switch(name){
          case 'about': makeWin('about', t('menu.about'), 'ðŸ›ˆ', 'About'); break;
          case 'experience': makeWin('experience', t('menu.experience'), 'ðŸ’¼', 'Experience'); break;
          case 'skills': makeWin('skills', t('menu.skills'), 'ðŸ§°', 'Skills'); break;
          case 'education': makeWin('education', t('menu.education'), 'ðŸŽ“', 'Education'); break;
          case 'download': makeWin('download', t('menu.download'), 'â¬‡', 'Download'); break;
          case 'contact': makeWin('contact', t('menu.contact'), 'âœ‰', 'Contact'); break;
          case 'badges': makeWin('badges', t('menu.badges'), '','ProjectsBadges'); break;
        }
        telemetry.cta('open_app', { name });
      };

      // Drag/Resize
      /**
       * An object representing the state and attributes of a drag operation.
       *
       * @property {boolean} active - Indicates if a drag operation is currently active.
       * @property {null|string|number} id - The identifier of the draggable element, initially set to null.
       * @property {number} startX - The x-coordinate where the drag operation started.
       * @property {number} startY - The y-coordinate where the drag operation started.
       * @property {Object} start - Stores the initial state or references at the start of the drag operation.
       * @property {boolean} ghost - Determines if a ghost element is being used during the drag operation.
       * @property {string} ghostStyle - Specifies the CSS style applied to the ghost element.
       */
      const drag = reactive({ active:false, id:null, startX:0, startY:0, start:{}, ghost:false, ghostStyle:'' });
      /**
       * Handles the initiation of a drag action for a draggable element.
       *
       * @param {MouseEvent} e - The mouse event that triggered the drag start.
       * @param {string | number} id - The unique identifier of the element being dragged.
       *
       * Initializes the drag state including the starting position of the mouse, the starting position of the element,
       * and applies a "ghost" representation of the drag. Attaches mousemove and mouseup event listeners to handle the
       * drag action and its termination respectively.
       */
      const startDrag = (e, id) => {
        const w = wm.find(id); if(!w) return;
        if (w.maximized) {
          bus.emit('window.feedback', { id, kind: 'shake' });
          return;
        }
        drag.active = true; drag.id = id; drag.startX = e.clientX; drag.startY = e.clientY; drag.start = { x:w.x, y:w.y };
        drag.ghost = true; drag.ghostStyle = `left:${w.x}px;top:${w.y}px;width:${w.w}px;height:${w.h}px;`;
        window.addEventListener('mousemove', onDrag); window.addEventListener('mouseup', endDrag);
      };
      /**
       * Handles the drag event for an interactive element.
       *
       * This function is triggered when a drag action is in progress, updating the
       * position of the dragged element based on the cursor's movement. If the drag
       * is not active or the target element cannot be found, the function exits
       * early. While the drag is in motion, the ghost representation of the element
       * is updated to follow the cursor's position, using calculated coordinates
       * relative to its starting position.
       *
       * @param {Event} e - The event object associated with the drag action, containing details
       * about the cursor's position and other event properties.
       */
      const onDrag = (e) => {
        if(!drag.active) return; const w = wm.find(drag.id); if(!w) return;
        const nx = drag.start.x + (e.clientX - drag.startX); const ny = drag.start.y + (e.clientY - drag.startY);
        drag.ghostStyle = `left:${nx}px;top:${ny}px;width:${w.w}px;height:${w.h}px;`;
      };
      /**
       * Handles the end of a drag operation, finalizing the position of the dragged element
       * and cleaning up event listeners and drag-related state.
       *
       * @param {MouseEvent} e - The mouse event triggered when the drag ends.
       * @returns {void}
       */
      const endDrag = (e) => {
        if(!drag.active) return; const w = wm.find(drag.id); if(!w) return;
        const nx = drag.start.x + (e.clientX - drag.startX); const ny = drag.start.y + (e.clientY - drag.startY);
        w.x = Math.max(4, Math.min(nx, innerWidth - 60)); w.y = Math.max(4, Math.min(ny, innerHeight - 100));
        drag.active=false; drag.id=null; drag.ghost=false; drag.ghostStyle='';
        window.removeEventListener('mousemove', onDrag); window.removeEventListener('mouseup', endDrag);
      };

      /**
       * Initiates a drag-and-resize interaction for a user interface element.
       *
       * This function sets up the necessary state and event listeners to allow resizing of a UI element. It tracks
       * the initial dimensions and position of the element, as well as the starting mouse position. The function
       * calculates the new dimensions dynamically as the mouse moves while enforcing minimum size constraints.
       * Resize updates are visualized using a ghost element until the resizing operation is completed.
       *
       * @param {MouseEvent} e - The mouse event object that contains the starting position of the mouse and
       * contextual information for the "mousedown" or similar triggering event.
       * @param {string} id - The unique identifier of the element to be resized, used to look up and update
       * its properties in the window manager (wm).
       */
      const startResize = (e, id) => {
        e.stopPropagation(); const w = wm.find(id); if(!w) return;
        drag.active = true; drag.id = id; drag.startX = e.clientX; drag.startY = e.clientY; drag.start = { w:w.w, h:w.h };
        drag.ghost = true; drag.ghostStyle = `left:${w.x}px;top:${w.y}px;width:${w.w}px;height:${w.h}px;`;
        const onMove = (ev) => {
          const nw = Math.max(340, drag.start.w + (ev.clientX - drag.startX));
          const nh = Math.max(220, drag.start.h + (ev.clientY - drag.startY));
          drag.ghostStyle = `left:${w.x}px;top:${w.y}px;width:${nw}px;height:${nh}px;`;
        };
        /**
         * Handles the "mouseup" event for a drag-and-resize operation on a user interface element.
         *
         * This function calculates the new width and height of the draggable or resizable UI element based on
         * the mouse's current position relative to the starting drag position. It ensures that the dimensions
         * do not fall below a minimum size and do not exceed the screen boundaries. After handling the resize,
         * it cleans up the drag state and removes related event listeners.
         *
         * @param {MouseEvent} ev - The mouse event object that contains the current position of the mouse
         * and contextual information for the "mouseup" event.
         */
        const onUp = (ev) => {
          const nw = Math.max(340, drag.start.w + (ev.clientX - drag.startX));
          const nh = Math.max(220, drag.start.h + (ev.clientY - drag.startY));
          w.w = Math.min(nw, innerWidth - w.x - 12); w.h = Math.min(nh, innerHeight - w.y - 54);
          drag.active=false; drag.id=null; drag.ghost=false; drag.ghostStyle='';
          window.removeEventListener('mousemove', onMove); window.removeEventListener('mouseup', onUp);
        };
        window.addEventListener('mousemove', onMove); window.addEventListener('mouseup', onUp);
      };

      /**
       * A reactive variable that holds a string value representing the clock.
       * This can be used to store and update a time-related string dynamically.
       *
       * The variable is initialized with an empty string.
       * Updates to this variable will automatically trigger reactivity in frameworks
       * that support reactive data bindings (e.g., Vue with ref()).
       */
      const clock = ref('');
      const tick = () => {
        const date = new Date();
        //clock.value = date.toISOString().substring(11,19) + 'Z';
        clock.value = date.toLocaleString('en-US', {
          hour: 'numeric',
          minute: 'numeric',
          hour12: true,
          timeZoneName: 'short'
        });
      };
      setInterval(tick, 1000); tick();

      const ui = reactive({ menu:false });

      const setLang = (l) => { lang.value = l; telemetry.cta('lang_switch', { variant:l }); };

      onMounted(() => {
        // Open About by default
        openApp('about');
      });

      return {
        env, appName, lang, t, telemetry,
        compositor, windows, tasks, ui,
        openApp, openViewer, focus, minimize, restore, toggleMaximize, closeWindow,
        startDrag, startResize, drag,
        clock, setLang
      };
    }
  });

  // Outside click directive for menu
  app.directive('click', { beforeMount(el, binding){ el.__clickOutside__ = (e)=>{ if(!(el===e.target||el.contains(e.target))) binding.value(e); }; document.addEventListener('click', el.__clickOutside__); }, unmounted(el){ document.removeEventListener('click', el.__clickOutside__); } });

  app.mount('#app');
</script>
</body>
</html>
